// Configuration file for MediaWiki Jobrunner
// This file is managed by Puppet
{
	"groups": {
		"basic": {
			// Number of runner processes in this group
			"runners": 19,
			// Job types to include ("*" means "all")
			"include": [
				"*"
			],
			// Job types to exempt (useful when combined with "*")
			"exclude": [
				"AssembleUploadChunks",
				"ParsoidCacheUpdateJobOnDependencyChange",
				"ParsoidCacheUpdateJobOnEdit",
				"PublishStashedFile",
				"gwtoolsetGWTFileBackendCleanupJob",
				"gwtoolsetUploadMediafileJob",
				"gwtoolsetUploadMetadataJob",
				"uploadFromUrl",
				"webVideoTranscode"
			],
			"low-priority": [
				"cirrusSearchLinksUpdate",
				"htmlCacheUpdate",
				"refreshLinks"
			]
		},
		"gwt": {
			"runners": 1,
			"include": [
				"gwtoolsetUploadMetadataJob",
				"gwtoolsetUploadMediafileJob",
				"gwtoolsetGWTFileBackendCleanupJob"
			]
		},
		"parsoid": {
			"runners": 20,
			"include": [
				"ParsoidCacheUpdateJobOnEdit"
			],
			"low-priority": [
				"ParsoidCacheUpdateJobOnDependencyChange"
			]
		},
		"transcode": {
			"runners": 0,
			"include": [
				"webVideoTranscode"
			]
		},
		"upload": {
			"runners": 7,
			"include": [
				"AssembleUploadChunks",
				"PublishStashedFile",
				"uploadFromUrl"
			]
		}
	},

	"limits": {
		// How many times to let jobs be recycled before abandoning
		"attempts": {
			"*": 3
		},
		// How long jobs can be claimed before being recycled
		"claimTTL": {
			"*": 3600,
			"webVideoTranscode": 86400
		},
		// Special:RunJobs process time limits
		"real": {
			"*": 300,
			"webVideoTranscode": 86400
		}
	},

	// Google Cloud project to use for Secrets Manager under Workload Identity on GKE.
	"project": "project-name",

	// Proxy to use to perform requests to Special:RunJob.
	"proxy": "http://nginx",

	"redis": {
		// Ready queue trackers
		"aggregators": [
			"rdb1001.eqiad.wmnet",
			"rdb1003.eqiad.wmnet"
		],
		// Main queue servers
		"queues": [
			"rdb1001.eqiad.wmnet",
			"rdb1003.eqiad.wmnet"
		],
		"password": "XXXXX"
	},

	// Address to send statsd metrics to
	"statsd": "statsd.eqiad.wmnet:8125",

	// URL to Special:RunJobs on the wikis.
	"url": "http://%(host)s/w/Special:RunJobs",

	"wikis": {
		"en_osrswiki": "oldschool.runescape.wiki",
		"en_rscwiki": "classic.runescape.wiki",
		"en_rswiki": "runescape.wiki",
		"metawiki": "meta.weirdgloop.org",
		"pt_rswiki": "pt.runescape.wiki"
	}
}
